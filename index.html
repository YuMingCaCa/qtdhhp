<!DOCTYPE html>
<html lang="vi">
<head>
    <link rel="icon" type="image/png" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjTnSBGofmGpcMY_uEoXhgAB-FeeLjVslu1A&s">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống quản lý nhiệm vụ giảng viên - ĐHHP</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom styles will be injected by js/main.js -->
</head>
<body class="p-4 md:p-8 bg-gray-50">

    <!-- Login Page -->
    <div id="login-page">
        <div class="max-w-md mx-auto mt-10 bg-white p-8 rounded-2xl shadow-lg">
            <div class="text-center mb-6">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjTnSBGofmGpcMY_uEoXhgAB-FeeLjVslu1A&s" alt="Logo" class="mx-auto h-20 mb-4">
                <h1 class="text-2xl font-bold text-blue-800">Đăng nhập hệ thống</h1>
                <p class="text-gray-600">Quản lý nhiệm vụ giảng viên</p>
            </div>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="login-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="login-email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-700">Mật khẩu</label>
                    <input type="password" id="login-password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Đăng nhập</button>
                </div>
            </form>
            <p class="mt-6 text-center text-sm text-gray-600">
                Chưa có tài khoản?
                <a href="#" id="show-register-link" class="font-medium text-blue-600 hover:text-blue-500">Đăng ký ngay</a>
            </p>
        </div>

        <div id="register-form-container" class="max-w-md mx-auto mt-10 bg-white p-8 rounded-2xl shadow-lg hidden">
             <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-blue-800">Đăng ký tài khoản</h1>
            </div>
            <form id="register-form" class="space-y-4">
                <div>
                    <label for="register-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="register-email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="register-password" class="block text-sm font-medium text-gray-700">Mật khẩu</label>
                    <input type="password" id="register-password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">Đăng ký</button>
                </div>
            </form>
            <p class="mt-6 text-center text-sm text-gray-600">
                Đã có tài khoản?
                <a href="#" id="show-login-link" class="font-medium text-blue-600 hover:text-blue-500">Đăng nhập</a>
            </p>
        </div>
    </div>
    
    <!-- Module Selection Page (New) -->
    <div id="module-selection-page" class="hidden">
        <div class="max-w-5xl mx-auto text-center mb-12">
             <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjTnSBGofmGpcMY_uEoXhgAB-FeeLjVslu1A&s" alt="Logo" class="mx-auto h-20 mb-4">
             <h1 class="text-3xl font-bold text-blue-800">Hệ thống Quản lý Nhiệm vụ Giảng viên</h1>
             <p class="text-lg text-gray-600">Trường Đại học Hải Phòng</p>
             <div class="mt-4">
                <span class="text-sm text-gray-600">Xin chào, <strong id="user-email-module-page" class="text-blue-700"></strong>!</span>
                <button id="logout-btn-module-page" class="ml-4 bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-lg text-sm">
                    <i class="fas fa-sign-out-alt mr-1"></i>Đăng xuất
                </button>
             </div>
        </div>
        <div class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Module 1: Workload Management -->
            <div id="module-workload" class="bg-white p-6 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 cursor-pointer flex flex-col items-center text-center">
                <div class="bg-blue-100 text-blue-600 rounded-full p-4 mb-4">
                    <i class="fas fa-tasks fa-2x"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Quản lý Giờ Lao động khác</h3>
                <p class="text-gray-600 flex-grow">Tổng hợp, báo cáo và quản lý giờ hoạt động phục vụ cộng đồng và chuyên môn khác.</p>
                <button class="mt-4 w-full bg-blue-600 text-white py-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors">Truy cập</button>
            </div>

            <!-- Module 2: Teaching Schedule -->
            <a href="lich-giang-day.html" class="bg-white p-6 rounded-xl shadow-lg hover:shadow-2xl hover:-translate-y-2 transition-all duration-300 flex flex-col items-center text-center no-underline">
                <div class="bg-purple-100 text-purple-600 rounded-full p-4 mb-4">
                    <i class="fas fa-calendar-alt fa-2x"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Sắp xếp Lịch giảng dạy</h3>
                <p class="text-gray-600 flex-grow">Lên lịch, sắp xếp và quản lý thời khóa biểu giảng dạy cho giảng viên.</p>
                <div class="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg font-semibold hover:bg-purple-700 transition-colors">Truy cập</div>
            </a>

            <!-- Module 3: Placeholder -->
            <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col items-center text-center text-gray-400">
                <div class="bg-gray-100 rounded-full p-4 mb-4">
                    <i class="fas fa-users fa-2x"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">Cố vấn học tập</h3>
                <p class="flex-grow">Tính năng đang được phát triển.</p>
                <button class="mt-4 w-full bg-gray-300 text-gray-500 py-2 rounded-lg font-semibold cursor-not-allowed">Truy cập</button>
            </div>
        </div>
    </div>

    <!-- Main App Content (Workload Management) -->
    <div id="app-content" class="hidden">
        <div class="max-w-7xl mx-auto">
            <!-- Back to modules button -->
            <button id="back-to-modules-btn" class="mb-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg inline-flex items-center transition-colors">
                <i class="fas fa-arrow-left mr-2"></i>
                <span>Quay lại trang chọn hệ thống</span>
            </button>
            
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <!-- Header -->
                <div class="flex items-center justify-between mb-8">
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRjTnSBGofmGpcMY_uEoXhgAB-FeeLjVslu1A&s" alt="Logo Trường Đại học Hải Phòng" class="h-16 md:h-20">
                    <div class="text-center">
                        <h1 class="text-xl md:text-3xl font-bold text-blue-800">Hệ thống quản lý nhiệm vụ hoạt động phục vụ cộng đồng và hoạt động chuyên môn khác của giảng viên theo giờ hành chính</h1>
                        <p class="text-md md:text-lg text-gray-600">Trường Đại học Hải Phòng</p>
                    </div>
                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQpzh7trviplRC5G2r75APp6H3wcTnXVixU-Q&s" alt="Logo Khoa Công nghệ Thông tin" class="h-16 md:h-20">
                </div>

                <!-- User Info and Logout -->
                <div class="flex justify-between items-center mb-6 border-t border-b py-2">
                    <div>
                        <span class="text-sm text-gray-600">Xin chào, <strong id="user-email" class="text-blue-700"></strong>!</span>
                        <span id="user-role-badge" class="ml-2 text-xs font-semibold px-2.5 py-0.5 rounded-full"></span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="change-password-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-1 px-3 rounded-lg text-sm">
                            <i class="fas fa-key mr-1"></i>Đổi mật khẩu
                        </button>
                        <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-lg text-sm">
                            <i class="fas fa-sign-out-alt mr-1"></i>Đăng xuất
                        </button>
                    </div>
                </div>

                <!-- Filters and Management -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6 items-end">
                    <div>
                        <label for="department-select" class="block text-sm font-medium text-gray-700 mb-1">Chọn Khoa:</label>
                        <select id="department-select" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"></select>
                    </div>
                    <div>
                        <label for="year-select" class="block text-sm font-medium text-gray-700 mb-1">Chọn Năm học:</label>
                        <div class="flex items-center gap-2">
                            <select id="year-select" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500"></select>
                            <button id="add-year-btn" class="p-3 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg shadow-sm admin-only" title="Thêm năm học mới"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                    <div class="flex flex-wrap gap-2 justify-start lg:justify-end">
                        <!-- Tools Dropdown -->
                        <div class="dropdown admin-only">
                            <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md flex items-center gap-2">
                                <i class="fas fa-tools"></i> Công cụ & Tác vụ <i class="fas fa-caret-down"></i>
                            </button>
                            <div class="dropdown-content">
                                <button id="add-entry-btn"><i class="fas fa-plus-circle fa-fw text-green-500"></i>Thêm Giờ</button>
                                <button id="bulk-edit-tool-btn"><i class="fas fa-edit fa-fw text-orange-500"></i>Sửa Hàng loạt</button>
                                <button id="bulk-delete-tool-btn"><i class="fas fa-eraser fa-fw text-red-500"></i>Xóa Hàng loạt</button>
                                <button id="statistics-tool-btn"><i class="fas fa-chart-bar fa-fw text-indigo-500"></i>Thống kê & Báo cáo</button>
                            </div>
                        </div>
                         <!-- Management Dropdown -->
                        <div class="dropdown admin-only">
                            <button class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg shadow-md flex items-center gap-2">
                                <i class="fas fa-cogs"></i> Quản lý hệ thống <i class="fas fa-caret-down"></i>
                            </button>
                            <div class="dropdown-content">
                                <button id="manage-users-btn"><i class="fas fa-user-shield fa-fw text-yellow-600"></i>Người dùng</button>
                                <button id="manage-tasks-btn"><i class="fas fa-tasks fa-fw text-purple-600"></i>Nhiệm vụ</button>
                                <button id="manage-departments-btn"><i class="fas fa-building fa-fw text-blue-600"></i>Khoa</button>
                                <button id="manage-lecturers-btn"><i class="fas fa-users fa-fw text-green-600"></i>Giảng viên</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content: Lecturers Table -->
                <div id="main-content">
                    <h2 id="department-title" class="text-2xl font-bold text-gray-800 mb-4">Tổng hợp Giờ Lao động</h2>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">STT</th>
                                    <th class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Họ và Tên</th>
                                    <th class="px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">Mã Giảng viên</th>
                                    <th class="px-6 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">Tổng giờ lao động khác</th>
                                    <th class="px-6 py-3 text-center text-xs font-bold text-gray-600 uppercase tracking-wider">Hành động</th>
                                </tr>
                            </thead>
                            <tbody id="lecturers-table-body" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Statistics Modal -->
    <div id="statistics-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('statistics-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Thống kê & Báo cáo</h3>
            <div class="p-4 border rounded-lg bg-gray-50 grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <div>
                    <label for="stats-department-select" class="block text-sm font-medium text-gray-700">Khoa</label>
                    <select id="stats-department-select" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></select>
                </div>
                <div>
                    <label for="stats-year-select" class="block text-sm font-medium text-gray-700">Năm học</label>
                    <select id="stats-year-select" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></select>
                </div>
                <div>
                    <label for="stats-lecturer-select" class="block text-sm font-medium text-gray-700">Giảng viên (tùy chọn)</label>
                    <select id="stats-lecturer-select" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></select>
                </div>
                <div class="md:col-span-3 flex flex-col sm:flex-row gap-2">
                    <button id="view-statistics-btn" class="flex-1 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                        <i class="fas fa-search mr-2"></i>Xem thống kê (GV)
                    </button>
                    <button id="export-department-report-btn" class="flex-1 w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg">
                        <i class="fas fa-file-pdf mr-2"></i>Xuất Báo cáo (Khoa)
                    </button>
                </div>
            </div>
            <div id="statistics-results-container" class="mt-4 hidden">
                <h4 id="statistics-results-title" class="font-semibold text-gray-800 mb-2">Kết quả thống kê:</h4>
                <div id="statistics-results-table" class="max-h-80 overflow-y-auto border rounded-md"></div>
                <div class="mt-4 flex justify-end">
                    <button id="export-report-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg hidden">
                        <i class="fas fa-file-pdf mr-2"></i>Xuất Báo cáo (GV)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="change-password-modal" class="modal">
        <div class="modal-content max-w-md">
            <span class="close-button no-print" onclick="closeModal('change-password-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Đổi mật khẩu</h3>
            <form id="change-password-form" class="space-y-4">
                <div>
                    <label for="current-password" class="block text-sm font-medium text-gray-700">Mật khẩu hiện tại</label>
                    <input type="password" id="current-password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
                <div>
                    <label for="new-password" class="block text-sm font-medium text-gray-700">Mật khẩu mới</label>
                    <input type="password" id="new-password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
                 <div>
                    <label for="confirm-new-password" class="block text-sm font-medium text-gray-700">Xác nhận mật khẩu mới</label>
                    <input type="password" id="confirm-new-password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm">
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">Lưu thay đổi</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage Users Modal -->
    <div id="manage-users-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('manage-users-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Quản lý Người dùng</h3>
            <div class="overflow-x-auto max-h-96">
                <table class="min-w-full bg-white">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left">Email</th>
                            <th class="px-4 py-2 text-left">Vai trò</th>
                            <th class="px-4 py-2 text-center">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="users-list-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Manage Tasks Modal -->
    <div id="manage-tasks-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('manage-tasks-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Quản lý Nhiệm vụ Quy đổi</h3>
            <form id="task-form" class="mb-4 p-4 border rounded-lg bg-gray-50">
                <input type="hidden" id="task-id">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <div class="md:col-span-2">
                        <label for="task-name" class="block text-sm font-medium text-gray-700">Tên nhiệm vụ</label>
                        <input type="text" id="task-name" placeholder="VD: Tham gia hội thảo khoa học" required class="mt-1 p-2 border rounded-md w-full">
                    </div>
                    <div>
                        <label for="task-unit" class="block text-sm font-medium text-gray-700">Đơn vị tính</label>
                        <input type="text" id="task-unit" placeholder="VD: buổi" required class="mt-1 p-2 border rounded-md w-full">
                    </div>
                    <div>
                        <label for="task-hours" class="block text-sm font-medium text-gray-700">Số giờ quy đổi</label>
                        <input type="number" id="task-hours" placeholder="VD: 12" min="0" step="0.5" required class="mt-1 p-2 border rounded-md w-full">
                    </div>
                    <div class="md:col-span-2 flex items-end gap-2">
                         <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white p-2 rounded-md">Lưu Nhiệm vụ</button>
                         <button type="button" id="clear-task-form-btn" class="w-full bg-gray-200 hover:bg-gray-300 text-black p-2 rounded-md">Làm mới</button>
                    </div>
                </div>
            </form>
            <div class="overflow-x-auto max-h-80">
                <table class="min-w-full bg-white">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left">Tên Nhiệm vụ</th>
                            <th class="px-4 py-2 text-left">Đơn vị</th>
                            <th class="px-4 py-2 text-center">Giờ</th>
                            <th class="px-4 py-2 text-center">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="tasks-list-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Bulk Add Modal -->
    <div id="bulk-add-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('bulk-add-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Thêm Giờ Lao động hàng loạt</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label for="bulk-add-department-select" class="block text-sm font-medium text-gray-700">Áp dụng cho Khoa:</label>
                    <select id="bulk-add-department-select" class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-gray-50"></select>
                </div>
                <div>
                    <label for="bulk-add-year-select" class="block text-sm font-medium text-gray-700">Lưu vào Năm học:</label>
                    <select id="bulk-add-year-select" class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-gray-50"></select>
                </div>
            </div>
            <div class="mb-4 border-b border-gray-200">
                <nav class="flex space-x-4" aria-label="Tabs">
                    <button id="tab-predefined" class="tab-button active px-3 py-2 font-medium text-sm rounded-t-lg border-b-2" onclick="switchTab('predefined')">Nhiệm vụ có sẵn</button>
                    <button id="tab-custom" class="tab-button px-3 py-2 font-medium text-sm rounded-t-lg border-b-2" onclick="switchTab('custom')">Nhiệm vụ khác</button>
                </nav>
            </div>
            <form id="bulk-add-form">
                <div id="predefined-task-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="task-select" class="block text-sm font-medium text-gray-700">Nhiệm vụ</label>
                            <select id="task-select" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></select>
                        </div>
                        <div>
                            <label for="task-quantity" class="block text-sm font-medium text-gray-700">Số lượng</label>
                            <input type="number" id="task-quantity" value="1" min="1" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="entry-date" class="block text-sm font-medium text-gray-700">Ngày bắt đầu</label>
                            <input type="date" id="entry-date" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="end-date" class="block text-sm font-medium text-gray-700">Ngày kết thúc</label>
                            <input type="date" id="end-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="start-time" class="block text-sm font-medium text-gray-700">Thời gian bắt đầu</label>
                            <input type="time" id="start-time" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="end-time" class="block text-sm font-medium text-gray-700">Thời gian kết thúc</label>
                            <input type="time" id="end-time" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="md:col-span-2">
                            <label for="predefined-notes" class="block text-sm font-medium text-gray-700">Ghi chú</label>
                            <textarea id="predefined-notes" rows="2" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Số giờ quy đổi / 1 GV</label>
                            <p id="calculated-hours" class="mt-1 text-lg font-bold text-blue-600">0 giờ</p>
                        </div>
                    </div>
                </div>
                <div id="custom-task-form" style="display: none;">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <label for="custom-task-description" class="block text-sm font-medium text-gray-700">Nội dung công việc</label>
                            <textarea id="custom-task-description" rows="2" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></textarea>
                        </div>
                        <div>
                            <label for="custom-entry-date" class="block text-sm font-medium text-gray-700">Ngày bắt đầu</label>
                            <input type="date" id="custom-entry-date" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="custom-end-date" class="block text-sm font-medium text-gray-700">Ngày kết thúc</label>
                            <input type="date" id="custom-end-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="custom-start-time" class="block text-sm font-medium text-gray-700">Thời gian bắt đầu</label>
                            <input type="time" id="custom-start-time" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="custom-end-time" class="block text-sm font-medium text-gray-700">Thời gian kết thúc</label>
                            <input type="time" id="custom-end-time" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="md:col-span-2">
                            <label for="custom-task-hours" class="block text-sm font-medium text-gray-700">Số giờ lao động B</label>
                            <input type="number" id="custom-task-hours" min="0" step="0.5" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="md:col-span-2">
                            <label for="custom-notes" class="block text-sm font-medium text-gray-700">Ghi chú</label>
                            <textarea id="custom-notes" rows="2" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <h4 class="font-semibold text-gray-800 mb-2">Chọn Giảng viên để áp dụng</h4>
                    <div class="flex items-center mb-2">
                        <input type="checkbox" id="select-all-lecturers" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="select-all-lecturers" class="ml-2 block text-sm text-gray-900">Chọn tất cả</label>
                    </div>
                    <div id="lecturer-checklist" class="max-h-48 overflow-y-auto border rounded-md p-2 grid grid-cols-1 sm:grid-cols-2 gap-2"></div>
                </div>
                <div class="mt-6 flex justify-end">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Lưu cho các GV đã chọn</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Manage Lecturers Modal -->
    <div id="manage-lecturers-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('manage-lecturers-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Quản lý Giảng viên</h3>
            <form id="lecturer-form" class="mb-4 p-4 border rounded-lg bg-gray-50">
                <input type="hidden" id="lecturer-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                    <div>
                        <label for="lecturer-name" class="block text-sm font-medium text-gray-700">Họ và tên</label>
                        <input type="text" id="lecturer-name" placeholder="VD: Nguyễn Văn A" required class="mt-1 p-2 border rounded-md w-full">
                    </div>
                    <div>
                        <label for="lecturer-code" class="block text-sm font-medium text-gray-700">Mã giảng viên</label>
                        <input type="text" id="lecturer-code" placeholder="VD: GV001" required class="mt-1 p-2 border rounded-md w-full">
                    </div>
                    <div>
                        <label for="lecturer-department" class="block text-sm font-medium text-gray-700">Khoa</label>
                        <select id="lecturer-department" required class="mt-1 p-2 border rounded-md w-full">
                            <option value="">-- Chọn Khoa --</option>
                        </select>
                    </div>
                    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white p-2 rounded-md">Lưu Giảng viên</button>
                </div>
            </form>
            <div class="overflow-x-auto max-h-80">
                <table class="min-w-full bg-white">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left">Họ và Tên</th>
                            <th class="px-4 py-2 text-left">Mã GV</th>
                            <th class="px-4 py-2 text-left">Khoa</th>
                            <th class="px-4 py-2 text-center">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="lecturers-list-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Manage Departments Modal -->
    <div id="manage-departments-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('manage-departments-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Quản lý Khoa</h3>
            <form id="department-form" class="mb-4 flex gap-2">
                <input type="hidden" id="department-id">
                <input type="text" id="department-name" placeholder="Tên khoa" required class="flex-grow p-2 border rounded-md">
                <button type="submit" class="bg-gray-600 hover:bg-gray-700 text-white p-2 rounded-md">Lưu Khoa</button>
            </form>
            <div class="overflow-x-auto max-h-80">
                <table class="min-w-full bg-white">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left">Tên Khoa</th>
                            <th class="px-4 py-2 text-center">Hành động</th>
                        </tr>
                    </thead>
                    <tbody id="departments-list-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="details-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('details-modal')">&times;</span>
            <h3 id="details-title" class="text-xl font-bold mb-4">Chi tiết Giờ Lao động</h3>
            <div id="details-controls" class="mb-4 p-2 border rounded-lg bg-gray-50 flex items-center justify-between no-print admin-only">
                <div class="flex items-center">
                    <input type="checkbox" id="select-all-entries" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="select-all-entries" class="ml-2 text-sm text-gray-700">Chọn tất cả</label>
                </div>
                <button id="delete-selected-entries-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded-lg text-sm">
                    <i class="fas fa-trash-alt mr-1"></i>Xóa mục đã chọn
                </button>
            </div>
            <div id="details-content" class="max-h-80 overflow-y-auto"></div>
        </div>
    </div>

    <!-- Edit Entry Modal -->
     <div id="edit-entry-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('edit-entry-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Chỉnh sửa Mục Giờ Lao động</h3>
            <form id="edit-entry-form">
                <input type="hidden" id="edit-entry-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label for="edit-entry-description" class="block text-sm font-medium text-gray-700">Nội dung công việc</label>
                        <textarea id="edit-entry-description" rows="2" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md bg-gray-100" readonly></textarea>
                    </div>
                     <div>
                        <label for="edit-entry-hours" class="block text-sm font-medium text-gray-700">Số giờ</label>
                        <input type="number" id="edit-entry-hours" min="0" step="0.5" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="edit-entry-date" class="block text-sm font-medium text-gray-700">Ngày bắt đầu</label>
                        <input type="date" id="edit-entry-date" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="edit-entry-end-date" class="block text-sm font-medium text-gray-700">Ngày kết thúc</label>
                        <input type="date" id="edit-entry-end-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="edit-entry-start-time" class="block text-sm font-medium text-gray-700">Thời gian bắt đầu</label>
                        <input type="time" id="edit-entry-start-time" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="edit-entry-end-time" class="block text-sm font-medium text-gray-700">Thời gian kết thúc</label>
                        <input type="time" id="edit-entry-end-time" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div class="md:col-span-2">
                        <label for="edit-entry-notes" class="block text-sm font-medium text-gray-700">Ghi chú</label>
                        <textarea id="edit-entry-notes" rows="2" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></textarea>
                    </div>
                </div>
                <div class="mt-6 flex justify-end">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Lưu thay đổi</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Year Modal -->
    <div id="add-year-modal" class="modal">
        <div class="modal-content max-w-md">
            <span class="close-button no-print" onclick="closeModal('add-year-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Thêm Năm học mới</h3>
            <form id="add-year-form">
                <label for="new-year-input" class="block text-sm font-medium text-gray-700">Năm học (định dạng YYYY-YYYY)</label>
                <input type="text" id="new-year-input" placeholder="2025-2026" required class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                <div class="mt-6 flex justify-end">
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">Thêm</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Delete Tool Modal -->
    <div id="bulk-delete-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('bulk-delete-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Công cụ Xóa Giờ lao động Hàng loạt</h3>
            <div class="p-4 border rounded-lg bg-gray-50 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="bulk-delete-department" class="block text-sm font-medium text-gray-700">Khoa</label>
                    <select id="bulk-delete-department" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></select>
                </div>
                <div>
                    <label for="bulk-delete-year" class="block text-sm font-medium text-gray-700">Năm học</label>
                    <select id="bulk-delete-year" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></select>
                </div>
                <div class="md:col-span-2">
                    <label for="bulk-delete-description" class="block text-sm font-medium text-gray-700">Nội dung công việc (chứa từ khóa)</label>
                    <input type="text" id="bulk-delete-description" placeholder="Nhập từ khóa trong tên nhiệm vụ hoặc ghi chú" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                </div>
                 <div>
                    <label for="bulk-delete-date" class="block text-sm font-medium text-gray-700">Ngày bắt đầu</label>
                    <input type="date" id="bulk-delete-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div class="md:col-span-2">
                    <button id="find-entries-to-delete-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                        <i class="fas fa-search mr-2"></i>Tìm kiếm các mục để xóa
                    </button>
                </div>
            </div>
            <div id="bulk-delete-results-container" class="mt-4 hidden">
                <h4 class="font-semibold text-gray-800 mb-2">Kết quả tìm kiếm:</h4>
                <div id="bulk-delete-results-summary" class="p-3 bg-yellow-100 border border-yellow-300 rounded-lg text-yellow-800 mb-2"></div>
                <div id="bulk-delete-results-list" class="max-h-60 overflow-y-auto border rounded-md p-2"></div>
                <div class="mt-4 flex justify-end">
                    <button id="confirm-bulk-delete-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Xóa tất cả các mục đã tìm thấy
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Edit Tool Modal -->
    <div id="bulk-edit-modal" class="modal">
        <div class="modal-content">
            <span class="close-button no-print" onclick="closeModal('bulk-edit-modal')">&times;</span>
            <h3 class="text-xl font-bold mb-4">Công cụ Sửa Giờ lao động Hàng loạt</h3>
            <!-- Search Section -->
            <div class="p-4 border rounded-lg bg-gray-50">
                <h4 class="font-semibold text-lg mb-2">1. Tìm kiếm các mục cần sửa</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="bulk-edit-department" class="block text-sm font-medium text-gray-700">Khoa</label>
                        <select id="bulk-edit-department" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></select>
                    </div>
                    <div>
                        <label for="bulk-edit-year" class="block text-sm font-medium text-gray-700">Năm học</label>
                        <select id="bulk-edit-year" class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></select>
                    </div>
                    <div class="md:col-span-2">
                        <label for="bulk-edit-description" class="block text-sm font-medium text-gray-700">Nội dung công việc (chứa từ khóa)</label>
                        <input type="text" id="bulk-edit-description" placeholder="Nhập từ khóa trong tên nhiệm vụ hoặc ghi chú" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div>
                        <label for="bulk-edit-date" class="block text-sm font-medium text-gray-700">Ngày bắt đầu</label>
                        <input type="date" id="bulk-edit-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                    </div>
                    <div class="md:col-span-2">
                        <button id="find-entries-to-edit-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                            <i class="fas fa-search mr-2"></i>Tìm kiếm các mục để sửa
                        </button>
                    </div>
                </div>
            </div>
            <!-- Results and Edit Section -->
            <div id="bulk-edit-results-container" class="mt-4 hidden">
                <h4 class="font-semibold text-lg mb-2">2. Kết quả & Các thay đổi cần áp dụng</h4>
                <div id="bulk-edit-results-summary" class="p-3 bg-yellow-100 border border-yellow-300 rounded-lg text-yellow-800 mb-2"></div>

                <!-- NEW: Detailed results list -->
                <div id="bulk-edit-results-list" class="max-h-60 overflow-y-auto border rounded-md p-2 mt-2"></div>

                <div class="p-4 border rounded-lg bg-gray-50 mt-4">
                    <p class="text-sm text-gray-600 mb-2">Điền thông tin vào các trường bạn muốn thay đổi. Bỏ trống các trường không muốn thay đổi.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="bulk-edit-new-date" class="block text-sm font-medium text-gray-700">Ngày bắt đầu MỚI</label>
                            <input type="date" id="bulk-edit-new-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label for="bulk-edit-new-end-date" class="block text-sm font-medium text-gray-700">Ngày kết thúc MỚI</label>
                            <input type="date" id="bulk-edit-new-end-date" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="md:col-span-2">
                            <label for="bulk-edit-new-notes" class="block text-sm font-medium text-gray-700">Ghi chú MỚI</label>
                            <textarea id="bulk-edit-new-notes" rows="2" placeholder="Nội dung ghi chú mới sẽ thay thế hoàn toàn ghi chú cũ." class="mt-1 block w-full p-2 border border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>
                </div>

                <div class="mt-4 flex justify-end">
                    <button id="confirm-bulk-edit-btn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg">
                        <i class="fas fa-save mr-2"></i>Áp dụng thay đổi
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Alert & Confirm Modals -->
    <div id="alert-modal" class="modal">
        <div class="modal-content max-w-sm">
             <h3 id="alert-title" class="text-lg font-bold mb-4">Thông báo</h3>
            <p id="alert-message" class="mb-6"></p>
            <div class="flex justify-end">
                <button id="alert-ok-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">OK</button>
            </div>
        </div>
    </div>
    <div id="confirm-modal" class="modal">
        <div class="modal-content max-w-sm">
            <h3 class="text-lg font-bold mb-4">Xác nhận</h3>
            <p id="confirm-message" class="mb-6"></p>
            <div class="flex justify-end gap-3">
                <button id="confirm-btn-no" class="bg-gray-200 hover:bg-gray-300 text-black font-bold py-2 px-4 rounded-lg">Hủy</button>
                <button id="confirm-btn-yes" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg">Xác nhận</button>
            </div>
        </div>
    </div>

    <!-- Main JavaScript File -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
